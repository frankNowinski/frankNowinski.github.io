<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Finding Upcoming Concerts of Your Favorite Bands &#8211; Frank Nowinski</title>
<meta name="description" content="My personal blog.">
<meta name="keywords" content="">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Finding Upcoming Concerts of Your Favorite Bands">
<meta property="og:description" content="My personal blog.">
<meta property="og:url" content="http://franknowinski.github.io/getting-a-users-top-artists-using-spotifys-api/">
<meta property="og:site_name" content="Frank Nowinski">





<link rel="canonical" href="http://franknowinski.github.io/getting-a-users-top-artists-using-spotifys-api/">
<link href="http://franknowinski.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Frank Nowinski Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://franknowinski.github.io/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://franknowinski.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<!-- <link rel="shortcut icon" href="http://franknowinski.github.io/favicon.ico"> -->
<link rel="shortcut icon" href="http://franknowinski.github.io/images/background-image.jpg">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://franknowinski.github.io/images/background-image.jpg">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://franknowinski.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://franknowinski.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://franknowinski.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://franknowinski.github.io/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
  <button class="dl-trigger">Open Menu</button>
  <ul class="dl-menu">
    <li><a href="http://franknowinski.github.io/">Home</a></li>
    <li>
      <a href="#">About</a>
      <ul class="dl-submenu">
        <li>
          <img src="http://franknowinski.github.io/images/space.jpg" alt="Frank Nowisnki photo" class="author-photo">
          <h4>Frank Nowisnki</h4>
          <p>My personal blog to express various coding obstacles I've faced on my journey to becoming a Web Developer.</p>
        </li>
        <li><a href="http://franknowinski.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li>
        <li>
          <a href="mailto:nowinski.frank@gmail.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
        </li>
        
        
        
        
        <li>
          <a href="https://github.com/frankNowinski"><i class="fa fa-fw fa-github"></i> GitHub</a>
        </li>
        
        
        
        
      </ul><!-- /.dl-submenu -->
    </li>
    <li>
      <a href="#">Posts</a>
      <ul class="dl-submenu">
        <li><a href="http://franknowinski.github.io/posts/">All Posts</a></li>
        <li><a href="http://franknowinski.github.io/tags/">All Tags</a></li>
      </ul>
    </li>
    
      
          
      
      <li><a href="http://franknowinski.github.io/theme-setup/" >Theme Setup</a></li>
    
  </ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://franknowinski.github.io/getting-a-users-top-artists-using-spotifys-api/" rel="bookmark" title="Finding Upcoming Concerts of Your Favorite Bands">Finding Upcoming Concerts of Your Favorite Bands</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2016-05-12T22:02:58-04:00">May 12, 2016</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
Reading time ~5 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>Spotify’s API has a whole host of endpoints that allow programmers to extract data; you can access everything from artists and their top songs to information about the users themselves. One endpoint I found particularly intriguing was the <em>User’s Top Artists and Tracks</em> endpoint where (as the title implies) Spotify collects data of a users most listened to artists and tracks. This is when I got thinking - if Spotify aggregates your top artists, wouldn’t it be cool if you could view the upcoming concerts of your favorite artists in your area? In this blog post I’m going to demonstrate how I used Spotify’s API in conjunction with the BandsInTown API to output all of the nearby upcoming concerts of my favorite artists.</p>

<p>Before we get underway, let’s add the <a href="https://github.com/guilhermesad/rspotify">RSpotify</a> gem into our app to help access the Spotify API as well as the <a href="https://github.com/taf2/curb">Curb</a> gem for formatting a get request (more on <code>Curb</code> later). Include the following gems in your Gemfile and run <code>bundle</code>: edit this</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">'rspotify'</span>
<span class="n">gem</span> <span class="s1">'curb'</span></code></pre></div>

<p>If our end goal is to display upcoming concerts of our top artists on Spotify, our first priority is to obtain a users top artists. In order to access a users Spotify account you’ll need to obtain an access token, provided by Spotify, that gives the developer permission to receive user information. This can be accomplished by configuring the following two files. In <code>application.rb</code> add:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">RSpotify</span><span class="o">::</span><span class="n">authenticate</span><span class="p">(</span><span class="no">ENV</span><span class="p">[</span><span class="s2">"SPOTIFY_CLIENT"</span><span class="p">],</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"SPOTIFY_SECRET"</span><span class="p">])</span></code></pre></div>

<p>Then, in <code>config/initializers/omniauth.rb</code> include:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'rspotify/oauth'</span>

<span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">middleware</span><span class="p">.</span><span class="nf">use</span> <span class="no">OmniAuth</span><span class="o">::</span><span class="no">Builder</span> <span class="k">do</span>
  <span class="n">provider</span> <span class="ss">:spotify</span><span class="p">,</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"SPOTIFY_CLIENT"</span><span class="p">],</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"SPOTIFY_SECRET"</span><span class="p">],</span>
  <span class="ss">scope: </span><span class="s1">'user-read-email user-top-read'</span>
<span class="k">end</span></code></pre></div>

<p>By including the <code>user-top-read</code> scope you’re asking the user for permission to access their top artists from Spotify. If the user accepts when they are prompted at log in, you’ll be granted an access token that you will later use in another request to the Spotify API. You can request additional user information by including other scopes found <a href="https://developer.spotify.com/web-api/using-scopes/">here</a>.</p>

<p>Next, provide a link so the user can log into their Spotify account:</p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Sign in with Spotify"</span><span class="p">,</span> <span class="s2">"/auth/spotify"</span> <span class="cp">%&gt;</span></code></pre></div>

<p>Now, we’ll need to create a callback so we can manipulate the data that’s returned to us from Spotify. Head to <code>routes.rb</code> and declare what controller and action you’ll like your callback to hit:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get</span> <span class="s2">"/auth/spotify/callback"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"users/spotify"</span></code></pre></div>

<p>You now have access to basic user information, such as name and email address, as well as the unique access token in the <code>spotify</code> action of your app.</p>

<p>Once you’ve retrieved the access token you’re ready to make a subsequent request to the Spotify API for a users top artists. To facilitate formatting the endpoint I relied on the <code>curb</code> gem which we previously installed in our app.</p>

<p>The <code>curb</code> gem offers a straightforward way to append headers in your GET request. The following code will correctly format your request to meet Spotify’s guidelines for the <em>Users Top Artist</em> endpoint:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">http</span> <span class="o">=</span> <span class="no">Curl</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"https://api.spotify.com/v1/me/top/artists?limit=25"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
  <span class="n">http</span><span class="p">.</span><span class="nf">headers</span><span class="p">[</span><span class="s1">'Accept'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'application/json'</span><span class="p">,</span>
  <span class="n">http</span><span class="p">.</span><span class="nf">headers</span><span class="p">[</span><span class="s1">'Authorization'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Bearer </span><span class="si">#{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span><span class="p">.</span><span class="nf">body_str</span>

<span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">http</span><span class="p">)</span></code></pre></div>

<p>You can request a minimum of one or a maximum of fifty artists by modifying the <code>limit</code> query parameter at the conclusion of the endpoint (ex: <code>limit=50</code>). Finally, replace <code>#{access_token}</code> with the actual access token, pass in the http local variable as an argument to the <code>JSON.parse</code> method and you’ll receive your top artists!</p>

<h2>Finding local concerts using the BandsInTown API</h2>

<p>In accordance with the BandsInTown API, if we receive upcoming concerts for a particular artist we’ll have to construct the following URL:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"http://api.bandsintown.com/artists/</span><span class="si">#{</span><span class="n">artist_name</span><span class="si">}</span><span class="s2">/events/recommended?location=</span><span class="si">#{</span><span class="n">location</span><span class="si">}</span><span class="s2">&amp;app_id=</span><span class="si">#{</span><span class="n">app_id</span><span class="si">}</span><span class="s2">&amp;api_version=</span><span class="si">#{</span><span class="n">api_version</span><span class="si">}</span><span class="s2">&amp;format=</span><span class="si">#{</span><span class="nb">format</span><span class="si">}</span><span class="s2">"</span></code></pre></div>

<p>The BandsInTown API  artist endpoint requires the following five parameters:</p>
<ol>
  <li>artist_name: Populate the artist_name parameter with the artist you’d like to look up. Feel free to use spaces to separate words since we’ll be escaping the URL later in this tutorial. For demonstration purposes, let’s look up the artist 'Kanye West'.</li>
  <li>location: To get upcoming concerts in an area nearby your current location, insert 'use_geoip&amp;radius=50' in the location parameter. 'use_geoip' uses the ip address of your computer to find your current location. Then, set the 'radius' parameter, which is measured in miles, to however far you’d be willing to travel to see one of your favorite bands (maximum distance is 150 miles). For this post, we’ll find concerts for our most listened to artists that are within a 50 mile radius of our current location.</li>
  <li>app_id: your app_id could be anything you wish, although it’s best practice to use a word, or words, that reflect the app you’re building. For the purpose of this tutorial, the app_id will be discover-shows.</li>
  <li>version: There are two versions of the BandsInTown API: 1.0 and 2.0. We’ll use 2.0 because it’s more current.</li>
  <li>format: Finally, fill in the format parameter with 'json' so our data will be returned to us in json format.</li>
</ol>

<p>Now our url should look like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="s2">"http://api.bandsintown.com/artists/Kanye West/events/recommended?location=use_geoip&amp;radius=50&amp;app_id=discover-shows&amp;api_version=2.0&amp;format=json"</span></code></pre></div>

<p>See that space between ‘Kanye’ and ‘West’? That’s no good, and will generate an error if we submit this URL to the BandsInTown API. To prevent this, it’s as easy as passing our URL into the URI.escape method as an argument. The URI.escape method, which comes preinstalled in Ruby, will replace any whitespace characters with <code>%20</code>, resulting in a valid URL.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">escaped_url</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">escape</span><span class="p">(</span><span class="s2">"http://api.bandsintown.com/artists/Kanye West/events/recommended?location=use_geoip&amp;radius=50&amp;app_id=discover-shows&amp;api_version=2.0&amp;format=json"</span><span class="p">)</span>
<span class="c1">#=&gt; escaped_url = "http://api.bandsintown.com/artists/Kanye%20West/events/recommended?location=use_geoip&amp;radius=50&amp;app_id=discover-shows&amp;api_version=2.0&amp;format=json"</span></code></pre></div>

<p>Next, we’ll convert this URL into an URI object by passing it into the URI.parse method:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">escaped_url</span><span class="p">)</span></code></pre></div>

<p>Now we’re ready to send a get request to the BandsInTown API. We can accomplish this by passing the formatted <code>uri</code> variable into the <code>get_response</code> method of the <code>Net::HTTP</code> class:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">response</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_response</span><span class="p">(</span><span class="n">uri</span><span class="p">).</span><span class="nf">body</span></code></pre></div>

<p>Chaining <code>body</code> to the end of the <code>get_response</code> method returns the body of the response, or the data in which we are looking for. The response is a representation of Kanye West’s upcoming concerts in JSON format. All that’s left to do is parse the response!</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></code></pre></div>

<p>If we were to encapsulate all of our code, do a little refactoring, and put it inside a method, we’d get:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">events</span>
  <span class="n">escaped_uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">escape</span><span class="p">(</span><span class="s2">"http://api.bandsintown.com/artists/Kanye West/events/recommended?location=use_geoip&amp;radius=50&amp;app_id=discover-shows&amp;api_version=2.0&amp;format=json"</span><span class="p">)</span>
  <span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">escaped_uri</span><span class="p">)</span>
  <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_response</span><span class="p">(</span><span class="n">uri</span><span class="p">).</span><span class="nf">body</span><span class="p">)</span>
<span class="k">end</span></code></pre></div>

<p>There you have it. That’s how to use the Spotify API combined with the BandsInTown API to retrieve upcoming concerts of your most listened to bands on Spotify. You can view all of the other endpoints Spotify’s API has to offer <a href="https://developer.spotify.com/web-api/endpoint-reference/">here</a>.</p>

      <footer class="entry-meta">
        <span class="entry-tags"></span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://franknowinski.github.io/getting-a-users-top-artists-using-spotifys-api/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://franknowinski.github.io/getting-a-users-top-artists-using-spotifys-api/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=http://franknowinski.github.io/getting-a-users-top-artists-using-spotifys-api/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="http://franknowinski.github.io/editing-a-form-asynchronously/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="http://franknowinski.github.io/what-is-idempotency-and-why-is-it-useful/" title="What Is Idempotency and Why Is It Useful?">What Is Idempotency and Why Is It Useful?</a></h3>
      <p>Just the other day I was on a phone interview when I was asked to explain the benefits of idempotency. At first, this term bewildered me,...&hellip; <a href="http://franknowinski.github.io/what-is-idempotency-and-why-is-it-useful/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="http://franknowinski.github.io/website-hosting-behind-the-scenes/" title="Behind the Scenes of Website Hosting">Behind the Scenes of Website Hosting</a></h4>
        <span>Published on September 30, 2016</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="http://franknowinski.github.io/factories-vs-services/" title="Factories vs Services">Factories vs Services</a></h4>
        <span>Published on August 31, 2016</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2017 Frank Nowisnki.</span>

   <!-- Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span> -->

  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://franknowinski.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://franknowinski.github.io/assets/js/scripts.min.js"></script>



	        

</body>
</html>
